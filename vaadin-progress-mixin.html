<!--
@license
Copyright (c) 2017 Vaadin Ltd.
This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
-->

<!--
  Vaadin.ProgressMixin is a mixin, that implements common functionality for all progresses.
-->

<script>
  window.Vaadin = window.Vaadin || {};
 
  /**
   * @polymerMixin
   */

  Vaadin.ProgressMixin = superClass =>
    class VaadinProgressMixin extends superClass {
      static get properties() {
        return {
          /*
          * Displays current progress
          */
          value: {
            type: Number,
            reflectToAttribute: true
          },
          /*
          * Minimum bound of the progress bar. Can't be greater then max.
          */
          min: {
            type: Number,
            value: 0,
            reflectToAttribute: true,
            observer: '_minChanged'
          },
          /*
          * Maximum bound of the progress bar. Can't be less then min.
          */
          max: {
            type: Number,
            value: 1,
            reflectToAttribute: true,
            observer: '_maxChanged'
          },
          /*
          * Percent of current progress relative to whole progress bar (max - min)
          */
          normalizedValue: {
            type: Number,
            computed: '_normalizeValue(value, min, max)'
          }
        };
      }

      _minChanged(newV, oldV) {
        if (newV >= this.max) {
          try {
            throw new Error('min should be less then max');
          } finally {
            this.min = oldV;
          }
        }
      }

      _maxChanged(newV, oldV) {
        if (newV <= this.min) {
          try {
            throw new Error('min should be less then max');
          } finally {
            this.max = oldV;
          }
        }
      }

      _normalizeValue(value, min, max) {
        if (!value && value != 0) return;

        var nV = (value - min) / (max - min);

        if (nV > 1) nV = 1;
        else if (nV < 0) nV = 0;

        return nV;
      }
    }
</script>
